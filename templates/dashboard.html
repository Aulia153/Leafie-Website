<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Leafie â€” Dashboard</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
</head>

<body>

  <!-- HEADER -->
  <header class="header">
    <div class="container nav">
      <div class="logo">
        <img src="{{ url_for('static', filename='image/logo.png') }}"
             alt="logo"
             onerror="this.src='/static/image/logo.png'">
        <span>Leafie</span>
      </div>

      <div class="nav-links">
        <a href="{{ url_for('auth_bp.logout') }}" class="nav-link">Logout</a>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="hero-overlay">
      <h1>Dashboard</h1>
      <p>Monitoring tanaman secara real-time dengan kontrol kamera & pompa otomatis</p>
    </div>
  </section>

  <!-- MAIN CONTENT -->
  <main class="main-content container">

    <!-- SUHU -->
    <section class="section">
      <h2 class="section-title">Suhu & Kelembapan</h2>
      <p class="section-subtitle">Update otomatis tiap 5 detik</p>

      <div class="grid-2">
        <div class="card temp-display">
          <div class="temp-label">Suhu Saat Ini</div>
          <div id="tempValue" class="temp-value">{{ data.temperature }} Â°C</div>
          <div id="timeValue" class="temp-feels">{{ data.timestamp }}</div>
        </div>

        <div class="card">
          <canvas id="tempChart"></canvas>
        </div>
      </div>
    </section>

    <!-- KELEMBAPAN TANAH -->
    <section class="section">
      <h2 class="section-title">Kelembapan Tanah</h2>

      <div class="grid-2">
        <div class="card humidity-card">
          <div class="humidity-label">Kelembapan Saat Ini</div>
          <div id="soilValue" class="humidity-value">{{ data.soil_moisture }}%</div>
          <div id="soilStatus" class="humidity-desc">--</div>
        </div>

        <div class="card">
          <canvas id="soilChart"></canvas>
        </div>
      </div>
    </section>

    <!-- POMPA -->
    <section class="section">
      <h2 class="section-title">Kontrol Pompa</h2>

      <div class="grid-2">
        <div class="card pump-control">
          <button id="pumpBtn" class="btn btn-outline">Toggle Pompa</button>
        </div>

        <div id="pumpCard" class="card pump-status">
          <div class="bulb-icon">ðŸ’¡</div>
          <div class="pump-text">
            Status Pompa: <span id="pumpState">{{ pump_state }}</span>
          </div>
        </div>
      </div>
    </section>

    <!-- KAMERA -->
    <section class="section">
      <h2 class="section-title">Kamera Monitoring</h2>

      <div class="grid-2">
        <div class="card camera-card">
          <img id="cameraFeed"
               src="http://192.168.74.253:81/stream"
               alt="Live Camera"
               class="camera-frame"
               onerror="this.src='/static/gambar/default_leaf.jpg'">
        </div>

        <div class="card camera-control">
          <button id="cameraBtn" class="btn btn-outline">
            {{ 'Matikan Kamera' if camera_state == 'ON' else 'Nyalakan Kamera' }}
          </button>

          <button id="captureLeafBtn" class="btn">Ambil Foto Daun</button>

          <label class="btn mt-2" for="uploadLeafInput">Upload Gambar Daun</label>
          <input type="file" id="uploadLeafInput" accept="static/gambar/*" style="display: none;">
        </div>
      </div>
    </section>

    <!-- MONITORING DAUN -->
    <section class="section">
      <h2 class="section-title">Monitoring Kesehatan Daun</h2>
      <p class="section-subtitle">Foto daun terbaru akan muncul setelah diambil dari kamera</p>

      <div class="card leaf-result">
        <div class="grid-2">

          <div class="leaf-status">
            <h4>Hasil Deteksi</h4>
            <p id="leafHealthStatus" class="status-text">Menunggu hasil...</p>
          </div>

          <div class="leaf-photo">
            <h4>Foto Daun Terbaru</h4>
            <img id="leafImage"
                 alt="Daun terbaru"
                 class="leaf-img"
                 onerror="this.src='/static/gambar/default_leaf.jpg'">
          </div>

        </div>
      </div>
    </section>

    <!-- AKTIVITAS -->
    <section class="section">
      <h2 class="section-title">Catatan Aktivitas</h2>

      <div class="activity-filter">
        <button class="filter-btn active" data-filter="all">Semua</button>
        <button class="filter-btn" data-filter="sensor">Sensor</button>
        <button class="filter-btn" data-filter="camera">Kamera</button>
        <button class="filter-btn" data-filter="pump">Pompa</button>
      </div>

      <div id="activityList" class="activity-list card">
        {% for log in activity %}
        <div class="activity-item" data-type="{{ log.type | default('general') }}">
          <div class="activity-content">
            <div class="activity-time">{{ log.time }}</div>
            <div class="activity-desc">{{ log.desc }}</div>
          </div>
        </div>
        {% endfor %}
      </div>
    </section>

    <!-- EXPORT -->
    <section class="section">
      <button id="exportBtn" class="btn">Download CSV (History)</button>
    </section>

  </main>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container">
      <p>Â© 2025 Leafie â€” All Rights Reserved</p>
    </div>
  </footer>

  <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>

</html>
